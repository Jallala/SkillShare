{% extends 'base.html' %}
{% load static %}
{% block content %}


<div class="container d-flex justify-content-center  align-items-center">
  <div class="bg-light shadow p-4 w-50" >

    <div class=" border rounded-4 p-4">
      <h2>{{ skill.title }}</h2>
      <p>{{ skill.description|default:"This skill does not have a description." }}</p>

      <p>
        <strong>Availability:</strong>
        {% if skill.availability %}
          <span class="badge bg-success">Available</span>
        {% else %}
          <span class="badge bg-secondary">Unavailable</span>
        {% endif %}
      </p>

      <p>
        <strong>Offered By:</strong>
        {% if skill.user.first_name or skill.user.last_name %}
          {{ skill.user.first_name }} {{ skill.user.last_name }} 
        {% else %}
          This account has not published a name.
        {% endif %}
      </p>

      <p>
        <strong>Place:</strong> {{skill.location}}
      </p>

      <h4>Average Rating:</h4>
      {% if average_rating %}
      {% with average_rating|floatformat:"0" as rounded_rating %}
        <span class="text-warning">
          {% for i in "12345" %}
            {% if forloop.counter <= rounded_rating|add:"0" %}
              ★
            {% else %}
              ☆
            {% endif %}
          {% endfor %}
        </span>
        ({{ average_rating|floatformat:1 }} / 5)
      {% endwith %}
      {% else %}
        <p>No ratings yet.</p>
      {% endif %}
      

      <div class="d-flex justify-content-center gap-4 mt-4">
        <a href="{% url 'skillswap_contact.chat' skill.user.id %}" 
            class="btn btn-outline-secondary">Contact/Request
        </a>
        {% if request.user != skill.user %}
          <button type="button" class="btn btn-outline-secondary"
            data-bs-toggle="modal"
            data-bs-target="#reviewModal"
            data-skill-id="{{ skill.id }}"
            data-skill-title="{{ skill.title }}">
            Leave a Review
          </button>
        {% else %}
          <a href="#" title="cannot review yourself" class="btn btn-outline-secondary">Leave a Review</a>
        {% endif %}
      </div>
    </div>  

      {# -------------------- REVIEWS LIST BELOW BUTTONS -------------------- #}
      <div class="mt-5 border shadow-sm p-4 rounded-4">
        <h3>Reviews</h3>
        {% if ratings %}
          {% for r in ratings %}
            <div class="border rounded-4 p-4 mb-3 bg-white shadow">
              <strong>{{ r.reviewer.username }}</strong>: 
              <div>
                <span class="text-warning">
                  {% for i in "12345" %}
                    {% if forloop.counter <= r.rating %}
                      ★
                    {% else %}
                      ☆
                    {% endif %}
                  {% endfor %}
                </span>
              </div>
              <p class="mb-0">{{ r.review }}</p>
            </div>
          {% endfor %}
        {% else %}
          <p class="text-muted">No reviews yet.</p>
        {% endif %}
      </div>
  </div>
</div>

{% include 'reviews/_review_modal.html' %}

{% endblock %}
